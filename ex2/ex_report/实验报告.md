# 计算机网络实验二

## express安装与练习demo

采用express框架，参考[Node.js搭建Web服务器 - 简书 (jianshu.com)](https://www.jianshu.com/p/a05835de5853)

期间踩坑：

1. npm install卡住不动：使用代理，目标路径下命令行，输入

   npm config set registry https://registry.npm.taobao.org

2. cannot find module express：在当前目录下再次npm install express

3. 获取本地ip：cmd->ipconfig，或直接用localhost

4. body-parser deprecated undefined extended...：参考网络资源

![6941fc87bae743c98a825f9b0746f9e3](E:\workplace\network_ex\ex2\ex_report\6941fc87bae743c98a825f9b0746f9e3.png)

https://blog.csdn.net/weixin_43654123/article/details/122340088

## html编写

编写一个简单的html即可。

由于需要使用本地服务器，对图片的导入不能是静态页面，直接导入相对路径。由于要包含一个logo，需要将图片转换为base64编码，传入img的src参数即可。可以编写后端代码进行转换，但不是本实验的重点，这里直接百度“图片转换base64”完成。

```
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>EX2</title>
</head>
<body>
  <a href="https://cc.nankai.edu.cn/" title="南开计算机">
  <img src="这里填入转换后的base64" width="150" alt="姚翙载" class="panel-cover__logo logo">
  </a>
  <hr class="panel-cover__divider">
  <p align="center"><font size="8">姚翙载</font><br />
  <font size="6" align="center">专业：计算机科学与技术</font><br/>
  <font size="5" align="center">学号：2011273</font><br/></p>
<p><i><font color="blue">计算机网络课程实验二</font></i></p>
</body>
</html>
```



## 使用express搭建服务器

经过实测，还需要使用npm install分别安装

express-session

cookie-parser

morgan

ejs

在安装好express的文件夹或子文件夹下,打开命令行

express -e 项目名称

打开项目文件中./bin/www设置ip和端口。为了好区分，我这里这样设置：

var port = normalizePort(process.env.PORT || '4321');
app.set('port', port);
app.set('host','127.6.7.8');



编写app.js，如下

```javascript
//导入express
var express =require("express");
var app =express();
app.use(express.static('public'))

//参数‘/’可当作设置url的根显示页面，这里即”http://localhost:3000/“访问的页面设置为index.html
app.get('/',(req,res)=>{
    res.sendFile(__dirname+"/"+"my1.html")        //设置/ 下访问文件位置
});

app.get("/yhz",(req,res)=>{
    res.sendFile(__dirname+"/"+"my2.html")        
})

var server =app.listen(5678,()=>{
    var port =server.address().port
    console.log("访问地址http://localhost:%s",port)
})
module.exports=app;
```

将编写好的html文件以及图片资源放在同级目录下

该目录下打开命令行，输入

npm start

此时可以通过上述www中设置的express服务器ip127.6.7.8，端口4321或监听的端口5678进入

也可以直接通过本地ip进入，例如localhost:5678

如图

![微信图片_20221025113805](E:\workplace\network_ex\ex2\ex_report\微信图片_20221025113805.png)

get传入参数/yhz，则进入my2.html界面，如图



![微信图片_20221025114417](E:\workplace\network_ex\ex2\ex_report\微信图片_20221025114417.png)

## WireShark抓包

安装wireshark，官网下载安装包安装，无脑next

安装后进行监听，打开wireshark，监听所有端口

之后再统一执行启动本地服务器。浏览器访问服务器ip和端口、关闭服务器等操作

停止抓包后，在wireshark中输入过滤器语句，过滤只有127.6.7.8的包

![微信图片_20221025114702](E:\workplace\network_ex\ex2\ex_report\微信图片_20221025114702.png)

捕获后大致如图

![微信图片_20221025115333](E:\workplace\network_ex\ex2\ex_report\微信图片_20221025115333.png)